<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15 puzzle</title>
</head>
<style>
*{
   margin-left: auto;
   margin-right: auto;
   text-align: center;
}
#moves {
   font-weight: bold;
   padding: 2px 5px;
   color: black;
 }
.blank {
   width: 50px;
   height: 50px;
   text-align: center;
}
.block {
   width: 50px;
   height: 50px;
   border: 2px solid black;
   text-align: center;
   background-color: rgba(3, 4, 90, 0.603);
   color:white;
   cursor: pointer;
}
 
 
</style>
<body>
    <div>
        <h1>15 Puzzle Game</h1>
        <table id="game" width="auto" padding="10px"  style="border:1px solid #000000;"></table></br>
        <p>Number of Moves: <span id='moves'>0</span></p>
        <button id="newGame">Restart</button>
    </div>
    <script>
       let moves = 0
       const rows = 4;
       const cols = 4;
       let space=[];
       const table = document.getElementById('game')
       let textMoves = document.getElementById("moves");;
       let arrayForBoard= new Array(rows);

    function start(){
        let button = document.getElementById("newGame");
        button.addEventListener( "click", startNewGame, false );
        startNewGame();
    }
    function startNewGame(){
        let arrayOfNumbers = new Array();
        let arrayHasNumberBeenUsed;
        let randomNumber = 0;
        let count = 0;
        textMoves.innerHTML = moves;
        // Create the proper board size.
        for (let i = 0; i < rows; i++){
            arrayForBoard[i] = new Array(cols);
        }
        // Set up a temporary array for
        // allocating unique numbers.
        arrayHasNumberBeenUsed = new Array(rows*cols);
        for (let i = 0; i < rows * cols; i++){
            arrayHasNumberBeenUsed[i] = 0;
        }
    
        // Assign random numbers to the board.
        for (let i = 0; i < rows * cols; i++){
            randomNumber = Math.floor(Math.random()*rows * cols);
        // If our random numer is unique, add it to the board.
        if (arrayHasNumberBeenUsed[randomNumber] == 0){
            arrayHasNumberBeenUsed[randomNumber] = 1;
            arrayOfNumbers.push(randomNumber);
        }
        else{ // Our number is not unique. Try again.
            i--;
        }
        }
        
        // Assign numbers to the game board.
        count = 0;
        for (let i = 0; i < rows; i++){
            for (let j = 0; j < cols; j++){
                
                arrayForBoard[i][j] = arrayOfNumbers[count];
                if (arrayForBoard[i][j] == 0){
                    space=[i,j]
                } 
                count++;
            }
        }
        showTable(space);
    }
  
    function showTable(space){
        let outputString = "";
        for (let i = 0; i < rows; i++){
            outputString += "<tr>";
            for (let j = 0; j < cols; j++){
                if (arrayForBoard[i][j] == 0){
                        outputString += "<td class='blank'> </td>";
                    }
                    else{
                        outputString += "<td class='block' onclick='moveThisNum(" + i + ", " + j + ", " + space[0] + ", " + space[1] + ")'>" + arrayForBoard[i][j] + "</td>";
                    }
        } 
        outputString += "</tr>";
        } 
        
        table.innerHTML = outputString;
    }
    function moveThisNum( tableRow, tableColumn, spaceRow, spaceCol){
        if (checkIfMoveable(tableRow, tableColumn, spaceRow, spaceCol, "up") ||
            checkIfMoveable(tableRow, tableColumn, spaceRow, spaceCol, "down") ||
            checkIfMoveable(tableRow, tableColumn, spaceRow, spaceCol, "left") ||
            checkIfMoveable(tableRow, tableColumn, spaceRow, spaceCol, "right") ){
            incrementMoves();
    }
    else{
        alert("The number is not moveable.");
    }
        
    if (checkIfWinner()){
        alert("Congratulations! You solved the puzzle in " + moves + " moves.");
        startNewGame();
    }
    }
    
    function checkIfMoveable(rowCoordinate, columnCoordinate, spaceRow, spaceCol, direction){
    // make the function work for all directions.
        rowOffset = 0;
        columnOffset = 0;
        
        if (direction == "up"){
            rowOffset = -1;
        }
        else if (direction == "down"){
            rowOffset = 1;
        }
        else if (direction == "left"){
            columnOffset = -1;
        }
        else if (direction == "right"){
            columnOffset = 1;
        }
        
        
        if(rowCoordinate == spaceRow){
            if(columnCoordinate == 3 && spaceCol == 0){
                curr = arrayForBoard[rowCoordinate][columnCoordinate]
                arrayForBoard[rowCoordinate][columnCoordinate] = 0;
                arrayForBoard[rowCoordinate][0] = arrayForBoard[rowCoordinate][1];
                arrayForBoard[rowCoordinate][1] = arrayForBoard[rowCoordinate][2];
                arrayForBoard[rowCoordinate][2] = curr
                showTable([rowCoordinate, columnCoordinate]);
                return true;
            }
            if(columnCoordinate == 0 && spaceCol == 3){
                curr = arrayForBoard[rowCoordinate][columnCoordinate]
                arrayForBoard[rowCoordinate][columnCoordinate] = 0;
                arrayForBoard[rowCoordinate][3] = arrayForBoard[rowCoordinate][2];
                arrayForBoard[rowCoordinate][2] = arrayForBoard[rowCoordinate][1];
                arrayForBoard[rowCoordinate][1] = curr;
                showTable([rowCoordinate, columnCoordinate]);
                return true;
            }
            if(columnCoordinate == 2 && spaceCol == 0){
                curr = arrayForBoard[rowCoordinate][columnCoordinate]
                arrayForBoard[rowCoordinate][columnCoordinate] = 0;
                arrayForBoard[rowCoordinate][0] = arrayForBoard[rowCoordinate][1];
                arrayForBoard[rowCoordinate][1] = curr;
                showTable([rowCoordinate, columnCoordinate]);
                return true;
            }
            if(columnCoordinate == 1 && spaceCol == 3){
                curr = arrayForBoard[rowCoordinate][columnCoordinate]
                arrayForBoard[rowCoordinate][columnCoordinate] = 0;
                arrayForBoard[rowCoordinate][3] = arrayForBoard[rowCoordinate][2];
                arrayForBoard[rowCoordinate][2] = curr;
                showTable([rowCoordinate, columnCoordinate]);
                return true;
            }
        }
        
        // Check if the block can be moved to the spot.
        // If it can, move it and return true.
        if (rowCoordinate + rowOffset >= 0 && columnCoordinate + columnOffset >= 0 &&
            rowCoordinate + rowOffset < rows && columnCoordinate + columnOffset < cols
        ){
            if ( arrayForBoard[rowCoordinate + rowOffset][columnCoordinate + columnOffset] == 0){
                arrayForBoard[rowCoordinate + rowOffset][columnCoordinate + columnOffset] = arrayForBoard[rowCoordinate][columnCoordinate];
                arrayForBoard[rowCoordinate][columnCoordinate] = 0;
                showTable([rowCoordinate, columnCoordinate]);
                return true;
            }
        }
        return false; 
        }

        
        function checkIfWinner(){
            let count = 1;
            for (let i = 0; i < rows; i++){
                for (let j = 0; j < cols; j++){
                    if (arrayForBoard[i][j] != count){
                        if ( !(count === rows * cols && arrayForBoard[i][j] === 0 )){
                            return false;
                        }
                    }
                count++;
                }
            } 
        return true;
    }
    function incrementMoves(){
        moves++;
        textMoves.innerHTML = moves;
    }
    window.addEventListener( "load", start, false ); // This event listener makes the function start() execute when the window opens. 

    </script>
</body>
</html>
